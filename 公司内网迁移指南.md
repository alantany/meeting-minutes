# 🚀 Meetily 公司内网迁移完整指南

## ✅ 已完成的准备工作

### 1. 下载的资源
- ✅ **Whisper语音模型**: 
  - `ggml-base.en.bin` (141MB) - 英语语音识别
  - `ggml-large-v3.bin` (2.9GB) - 高精度多语言识别
- ✅ **Ollama AI模型**: 
  - `deepseek-r1:14b` (9.0GB) - 推理优化模型
  - `gpt-oss:20b` (13GB) - 备选大模型
- ✅ **完整项目代码**: 包含所有依赖和配置
- ✅ **内网安全配置**: 已禁用所有外网连接

### 2. 创建的部署包
📦 **部署包位置**: `meetily-offline-package` (3.0GB)

## 🔄 内网迁移步骤

### 步骤1: 传输文件到内网环境
```bash
# 将整个部署包复制到内网服务器
scp -r meetily-offline-package user@internal-server:/path/to/destination/
```

或使用其他安全的文件传输方式（U盘、内网文件服务器等）

### 步骤2: 内网环境准备
在内网服务器上确保已安装：
- **Node.js** v18+
- **Python** 3.8+
- **Rust** 工具链
- **Ollama** AI运行环境

### 步骤3: 一键部署
```bash
cd meetily-offline-package
./deploy-offline.sh
```

### 步骤4: 手动配置Ollama模型（如果自动导入失败）
```bash
# 确保Ollama运行
ollama serve &

# 如果您已经有这些模型，可以跳过
# 否则需要在有网络时下载：
ollama pull deepseek-r1:14b
ollama pull gpt-oss:20b
```

### 步骤5: 启动应用
```bash
# 启动后端（终端1）
./start-backend.sh

# 启动前端（终端2）  
./start-frontend.sh
```

## 🔒 内网安全验证

### 已实施的安全措施：
1. ✅ **禁用数据分析**: 不向PostHog发送任何数据
2. ✅ **移除外网CSP**: 只允许本地连接
3. ✅ **本地模型**: Whisper和LLM都在本地运行
4. ✅ **离线优先**: 所有功能完全离线可用

### 网络连接验证：
应用只会连接这些本地端口：
- `localhost:8080` - 后端API
- `localhost:8178` - Whisper服务
- `localhost:11434` - Ollama服务

### 测试内网隔离：
```bash
# 断开外网连接后测试所有功能
sudo route add -net 0.0.0.0 reject  # 临时断网测试
# 确认应用正常工作后恢复网络
```

## 📊 系统资源要求

### 最低配置：
- **CPU**: 4核心
- **内存**: 16GB
- **存储**: 20GB可用空间

### 推荐配置：
- **CPU**: 8核心+
- **内存**: 32GB+
- **存储**: 50GB+ SSD

## 🛠️ 故障排除

### 常见问题：
1. **Ollama连接失败**
   ```bash
   # 检查服务状态
   ps aux | grep ollama
   # 重启服务
   ollama serve
   ```

2. **Whisper模型加载失败**
   ```bash
   # 检查模型文件
   ls -la models/
   # 确认文件完整性
   file models/ggml-*.bin
   ```

3. **前端启动失败**
   ```bash
   # 检查Rust环境
   source "$HOME/.cargo/env"
   # 重新安装依赖
   cd frontend && pnpm install
   ```

## 📋 功能测试清单

在内网环境中验证以下功能：
- [ ] 应用启动正常
- [ ] 创建新会议
- [ ] 音频录制功能
- [ ] 实时语音转录
- [ ] AI摘要生成
- [ ] 会议记录保存
- [ ] 历史记录查看
- [ ] 设置配置保存

## 🎯 性能优化建议

### 模型选择：
- **快速转录**: 使用 `base.en` 模型
- **高精度转录**: 使用 `large-v3` 模型
- **快速摘要**: 使用 `deepseek-r1:14b`
- **复杂分析**: 使用 `gpt-oss:20b`

### 系统优化：
```bash
# 增加文件描述符限制
ulimit -n 65536

# 优化内存使用
echo 'vm.swappiness=10' >> /etc/sysctl.conf
```

## 📞 支持信息

### 文档位置：
- 详细部署文档: `README-内网部署.md`
- API文档: 启动后访问 `http://localhost:8080/docs`
- 使用说明: `安装使用说明.md`

### 日志位置：
- 后端日志: 终端输出
- 前端日志: 应用内开发者控制台
- 系统日志: `/var/log/meetily/`

## 🎉 迁移完成确认

当您看到以下内容时，表示迁移成功：
- ✅ 后端API在8080端口运行
- ✅ 前端桌面应用正常打开
- ✅ 可以创建和录制会议
- ✅ AI摘要功能正常工作
- ✅ 所有数据存储在本地SQLite数据库

**恭喜！您的Meetily会议助手已成功部署到公司内网环境！** 🎊

---

## 📧 技术支持

如遇到问题，请检查：
1. 系统资源是否充足
2. 所有服务是否正常启动
3. 模型文件是否完整
4. 网络端口是否被占用

内网部署现已完全就绪，享受您的隐私优先会议助手！

